<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="card">

	<select id="findCard" resultType="cardvo" parameterType="long">
		<![CDATA[
			select no, deck_no as deckNo, title, description, start_date as startDate, end_date as endDate, sequence, finished
				from card 
				where deck_no = #{deck_no};
		]]>
	</select>
	
	<select id="findCardUser" resultType="uservo" parameterType="long">
		<![CDATA[
			select u.no, u.name, u.email , pm.leader, pm.manager
				from user u, proj_member pm 
			    where u.no = pm.user_no 
			    and pm.project_no=#{projectNo};
		]]>
	</select>

	<insert id="commentInsert" parameterType="commentvo">
		<![CDATA[
			insert into comment values(null, #{cardNo}, #{userNo}, #{projectNo}, #{content}, #{date})
		]]>
	</insert>

	<insert id="createCard" parameterType="cardvo">
		<![CDATA[
		insert into card 
		values(null, #{deckNo }, #{title }, #{description }, #{startDate }, #{endDate}, (SELECT IFNULL(MAX(d.sequence) + 1, 1) 
		FROM card c, deck d where d.no = #{deckNo } and c.deck_no = d.no), 'N');	
		]]>	
	</insert>
	
	<insert id="insertMember" parameterType="cardvo">
		<![CDATA[
		insert into card_member
		values(#{deckNo }, #{cardNo }, #{userNo })
		]]>	
	</insert>
	
	<select id="findComment" resultType="commentvo" parameterType="long">
		<![CDATA[
			select a.no, b.name, a.content, a.date, c.deck_no, a.card_no
				from comment a, user b, card c 
				where a.pm_user_no = b.no 
				and a.card_no=#{cardNo } and a.card_no = c.no;
		]]>
	</select> 
	
</mapper>
