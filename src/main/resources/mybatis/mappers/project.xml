<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="project">
	<select id="findUser" resultType="uservo">
		<![CDATA[
			select no, name, email from user
		]]>
	</select>
	
	<insert id="createProject" parameterType="projectvo">
		<![CDATA[
		insert
		  into project
		values (null, #{title }, #{description }, #{startDate }, #{endDate }, #{priority }, 'N')
		]]>
		<selectKey keyProperty="no" resultType="long" order="AFTER">
			<![CDATA[
		  	select last_insert_id()
	  		]]>
	  	</selectKey>	
	</insert>
	
	<insert id="insertMember" parameterType="map">
		<![CDATA[
			insert
				into proj_member
			 values (${userVo.no }, ${projectNo }, ${userVo.permission })
		]]>
	</insert>
	
	<select id="findProject" parameterType="long" resultType="projectvo">
		<![CDATA[
			select no, title, description, start_date as startDate, end_date as endDate, priority, finished
			 from project pj, proj_member pjm 
				where pj.no =  pjm.project_no 
					and pjm.user_no = #{userNo } 
					and pj.finished="N"
					order by priority desc, title asc;
		]]>
	</select>
	
	<select id="findCompleteProject" parameterType="long" resultType="projectvo">
		<![CDATA[
			select no, title, description, start_date as startDate, end_date as endDate, priority, finished
			 from project pj, proj_member pjm 
				where pj.no =  pjm.project_no 
					and pjm.user_no = #{userNo } 
					and pj.finished="Y";
		]]>
	</select>
	
</mapper>
